# 05 - Delegation (대리인 위임)

DID Owner가 다른 주소에게 서명 권한을 위임하는 방법을 배웁니다.

## 📚 학습 목표

1. **대리인 추가**: Owner가 Delegate 권한 부여
2. **대리 서명**: Delegate가 Owner를 대신하여 서명
3. **권한 철회**: Owner가 Delegate 권한 제거

## 🚀 실행 방법

```bash
# 예제 실행
pnpm run 05
```

## 💡 핵심 개념

### 1. 시나리오

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  CEO (Owner)              비서 (Delegate)                   │
│       │                       │                             │
│       │  addDelegate()        │                             │
│       │ ─────────────────────→│                             │
│       │  "서명 권한 위임"      │                             │
│       │                       │                             │
│       │                       │  계약서 서명                │
│       │                       │ ─────────────────→ 거래처   │
│       │                       │  (CEO를 대신하여)           │
│       │                       │                             │
│       │  revokeDelegate()     │                             │
│       │ ─────────────────────→│                             │
│       │  "권한 철회"           │                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2. Delegate Type

| Type      | 용도           |
| --------- | -------------- |
| `sigAuth` | 서명/인증 권한 |
| `veriKey` | 검증 키 권한   |

### 3. 대리 서명 검증

```
대리 서명 문서
     │
     ├─ 1. 서명 검증
     │      └── 서명에서 주소 복원
     │
     ├─ 2. Delegate 권한 확인
     │      └── validDelegate(identity, type, delegate)
     │
     └─ 3. 두 조건 모두 충족 → ✅ 유효
```

### 4. 권한 라이프사이클

```
addDelegate(identity, type, delegate, validity)
     │
     ▼
┌─────────────────────────────────────┐
│  Delegate 활성화                     │
│  • 서명 가능                         │
│  • validDelegate() = true           │
└─────────────────────────────────────┘
     │
     ├─ 유효기간 만료 또는
     │
     ▼ revokeDelegate()
┌─────────────────────────────────────┐
│  Delegate 비활성화                   │
│  • 서명 불가                         │
│  • validDelegate() = false          │
└─────────────────────────────────────┘
```

## 💼 사용 사례

- **기업**: CEO → 비서에게 계약서 서명 권한 위임
- **의료**: 부모 → 보호자에게 의료 동의서 서명 권한
- **법인**: 법인 → 이사에게 특정 업무 서명 권한
- **서버**: 키 교체 시 임시 위임

## 🔗 관련 자료

- [ERC-1056 addDelegate](https://eips.ethereum.org/EIPS/eip-1056)

## ➡️ 다음 예제

[06-revocation](../06-revocation/) - VC 폐기
