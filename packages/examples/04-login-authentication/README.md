# 04 - Login Authentication (DID 로그인)

비밀번호 없이 DID와 지갑 서명만으로 로그인하는 방법을 배웁니다.

## 📚 학습 목표

1. **챌린지-응답**: 서버가 챌린지 생성, 클라이언트가 서명
2. **서명 검증**: 서버에서 서명 검증 후 세션 발급
3. **보안 테스트**: 재사용 공격, 위조 공격 방어

## 🚀 실행 방법

```bash
# 예제 실행
pnpm run 04
```

## 💡 핵심 개념

### 1. 로그인 흐름

```
클라이언트                    서버
    │                          │
    │ 1. 챌린지 요청           │
    │ ────────────────────────→│
    │                          │ 챌린지 생성 & 저장
    │ 2. 챌린지 반환           │
    │ ←────────────────────────│
    │                          │
    │ 3. MetaMask 서명         │
    │ (개인키로 챌린지 서명)    │
    │                          │
    │ 4. 서명 전송             │
    │ ────────────────────────→│
    │                          │ 서명 검증
    │                          │ DID 확인
    │ 5. 세션 토큰 발급        │
    │ ←────────────────────────│
```

### 2. 서명 검증

```
서명 + 챌린지
     │
     ▼ ecrecover

복원된 주소
     │
     ▼ DID에서 주소 추출

복원 주소 == DID 주소 → ✅ 인증 성공!
```

### 3. 보안 기능

| 공격          | 방어 방법                    |
| ------------- | ---------------------------- |
| 챌린지 재사용 | 일회용 챌린지 (사용 후 삭제) |
| 챌린지 만료   | 5분 후 자동 만료             |
| 서명 위조     | 개인키 없이 서명 불가        |
| DID 사칭      | 서명 주소와 DID 주소 비교    |
| 세션 탈취     | 세션 만료 시간 설정          |

### 4. 기존 로그인과 비교

| 항목        | 기존 (아이디/비밀번호) | DID 로그인         |
| ----------- | ---------------------- | ------------------ |
| 인증 수단   | 비밀번호               | 지갑 서명          |
| 서버 저장   | 비밀번호 해시          | 없음               |
| 분실 위험   | 비밀번호 분실          | 지갑 복구 가능     |
| 피싱 저항   | 낮음                   | 높음 (도메인 확인) |
| 다중 서비스 | 각각 가입              | 하나의 지갑        |

## 🔗 관련 자료

- [Sign-In with Ethereum](https://eips.ethereum.org/EIPS/eip-4361)

## ➡️ 다음 예제

[05-delegation](../05-delegation/) - 대리인 위임
